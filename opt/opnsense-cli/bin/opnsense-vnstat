#!/usr/bin/env bash

# Enable debug mode
if [[ "$DEBUG" ]]; then
  export PS4='+ [${BASH_SOURCE##*/}:$LINENO] '
  set -x
fi

hourly=$(opnsense-vnstat-json hourly)
daily=$(opnsense-vnstat-json daily)
monthly=$(opnsense-vnstat-json monthly)
yearly=$(opnsense-vnstat-json yearly)
total=$(opnsense-vnstat-json total)

jq -n \
  --arg     fetched_at "$(date '+%F %T')" \
  --argjson hourly     "$hourly" \
  --argjson daily      "$daily" \
  --argjson monthly    "$monthly" \
  --argjson yearly     "$yearly" \
  --argjson total      "$total" \
  '{
    $fetched_at,
    $hourly,
    $daily,
    $monthly,
    $yearly,
    $total
  }'
