#!/usr/bin/env bash

# Enable debug mode
if [[ "$DEBUG" ]]; then
  export PS4='+ [${BASH_SOURCE##*/}:$LINENO] '
  set -x
fi

hourly=$(opnsense-bandwidth-json hourly)
daily=$(opnsense-bandwidth-json daily)
monthly=$(opnsense-bandwidth-json monthly)
yearly=$(opnsense-bandwidth-json yearly)

jq -n \
  --arg     fetched_at "$(date '+%F %T')" \
  --argjson hourly     "$hourly" \
  --argjson daily      "$daily" \
  --argjson monthly    "$monthly" \
  --argjson yearly     "$yearly" \
  '{
    $fetched_at,
    $hourly,
    $daily,
    $monthly,
    $yearly
  }'
