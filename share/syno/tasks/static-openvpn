#!/usr/bin/env bash

CONTAINER_NAME=network.priddle.transmission
FEEDS=/volume1/docker/network.priddle.home/public/feeds

(docker exec "$CONTAINER_NAME" dig -4 ch txt whoami.cloudflare +short @1.1.1.1 +time=10 2> /dev/null || echo UNKNOWN) |
  tr -d '"' |
  jq -Rn '. | .openvpn_ip = input' \
  > "$FEEDS/openvpn/vpn-ip.json"

(dig -4 ch txt whoami.cloudflare +short @1.1.1.1 +time=10 2> /dev/null || echo UNKNOWN) |
  tr -d '"' |
  jq -Rn '. | .real_ip = input' \
  > "$FEEDS/openvpn/real-ip.json"

jq -s add \
  "$FEEDS/openvpn/real-ip.json" \
  "$FEEDS/openvpn/vpn-ip.json" \
  > "$FEEDS/openvpn/ips.json"
