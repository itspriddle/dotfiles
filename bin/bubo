#!/usr/bin/env bash
# Usage: bubo
#
# Runs `brew update` and `brew outdated`

set -e

if ! type brew &> /dev/null; then
  echo "Error: \`brew\` not found."
  exit 1
fi

cd $(brew --repository)

current_sha=$(git rev-parse HEAD)

brew update

new_sha=$(git rev-parse HEAD)

if [ "${current_sha}" != "${new_sha}" ]; then
  echo -e "\n\033[34m==>\033[0m \033[01mgit diff\033[0m"
  git log ${current_sha}..${new_sha}
fi

outdated=$(brew outdated --verbose)

echo -e "\n\033[34m==>\033[0m \033[01mOutdated brews\033[0m"

if [[ -n $outdated ]]; then
  echo "$outdated"
else
  echo "none - all up to date!"
fi
