#!/usr/bin/env zsh
unsetopt menu_complete   # do not autoselect the first completion entry
unsetopt flowcontrol
setopt auto_menu         # show completion menu on succesive tab press
#setopt complete_in_word
setopt complete_aliases
setopt always_to_end
# Make aliases complete properly (eg: gco => git checkout)
setopt no_complete_aliases

autoload -U compinit
compinit -i

# Case insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

# Ambiguous case insensitive completion
# Eg: ites[tab] completes to Sites
#zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

# pasting with tabs doesn't perform completion
zstyle ':completion:*' insert-tab pending

# Force rehash of commands
zstyle ":completion:*:commands" rehash 1

# SSH host completion
_ssh_hosts=(${${${${${${(f)"$(<$HOME/.ssh/known_hosts)"}:#[\|]*}%%\ *}%%,*}//]:[0-9]*}//\[}) || _ssh_hosts=()
hosts=("${_ssh_hosts[@]}" localhost)

zstyle ':completion:*:hosts' hosts $hosts

# Custom completion for git
zstyle ':completion:*:*:git:*' user-commands \
  travis:'Open travis-ci.org page for this repo' \
  flow:'git flow' \
  repl:'Open a repl'
