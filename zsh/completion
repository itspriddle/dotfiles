#!/usr/bin/env zsh
unsetopt menu_complete   # do not autoselect the first completion entry
unsetopt flowcontrol
setopt auto_menu         # show completion menu on succesive tab press
#setopt complete_in_word
setopt complete_aliases
setopt always_to_end

autoload -U compinit
compinit -i

# pasting with tabs doesn't perform completion
zstyle ':completion:*' insert-tab pending

# Force rehash of commands
zstyle ":completion:*:commands" rehash 1

# HACK: Force rehash of items in PATH
#_force_rehash() {
#  (( CURRENT == 1 )) && rehash
#  return 1	# Because we didn't really complete anything
#}
#zstyle ':completion:*' completer _force_rehash _complete _approximate

# SSH host completion
_ssh_hosts=(${${${${${${(f)"$(<$HOME/.ssh/known_hosts)"}:#[\|]*}%%\ *}%%,*}//]:[0-9]*}//\[}) || _ssh_hosts=()
hosts=("${_ssh_hosts[@]}" localhost)
zstyle ':completion:*:hosts' hosts $hosts
