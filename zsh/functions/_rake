#compdef rake
if [ -f Rakefile ]; then
  if [[ -f .rake_tasks~ ]] && [[ -s .rake_tasks~ ]]; then
    rm .rake_tasks~
  fi

  recent=`ls -t .rake_tasks~ Rakefile **/*.rake Gemfile Gemfile.lock 2> /dev/null | head -n 1`

  if [[ $recent != '.rake_tasks~' ]]; then
    rake --silent --tasks | cut -d " " -f 2 > .rake_tasks~
  fi

  compadd `cat .rake_tasks~`
fi
